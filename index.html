<!DOCTYPE html>
<html>
<head>
	<title>Grid test</title>
	<script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="js/lib/jquerycollision1.0.2min/jquery-collision.min.js"></script>
	<script type="text/javascript" src="bower_components/leapjs/leap-0.6.4.js"></script>
	<script type="text/javascript" src="bower_components/leapjs-plugins/main/leap-plugins-0.1.11.js"></script>
	<script type="text/javascript" src="js/Cursor.js"></script>
	<link type="text/css" rel="stylesheet" href="css/main.css" media="all">
</head>
<body>
<div id="grid" class="grid">
</div>
<div class="cell-container">
<a class="flip-container cell" href="#">
	<div class="flipper">
		<div class="front">
			<!-- front content -->
			Front
		</div>
		<div class="back">
			<!-- back content -->
			Back
		</div>
	</div>
</a>
</div>

<script>
	$(document).ready( function (){
		// Setup a grid
		for(var i = 0; i < 300; i++){
			var newDiv = $(".cell-container").first().clone(),
				x = $(window).width()/2,
				y = $(window).height()/2,
				z = 0
				;
			$(newDiv).css("transform" , "translate3d("+x+"px,"+y+"px,"+z+"px)");
			$('#grid').append(newDiv);
 		}
 		resize();

 		function resize(){
 			
 			var cellsPerRow = Math.floor($(window).width()/450);
 			$(".cell-container").each( function (i, newDiv){
 				var 
 					x =  450 * (i % cellsPerRow),
					y =  400 * Math.floor(i/cellsPerRow),
					z =  0;
 				$(newDiv).css("transform" , "translate3d("+x+"px,"+y+"px,"+z+"px)");
 			});
 		}

 		$(window).resize(function(){
 			resize();
 		})
 		$("body>.cell-container").detach();

 		$('#grid .cell').on("click touchstart", function(e){
				$('#grid .cell-container').removeClass("active");
 				$('#grid .cell-container').removeClass("zoom");
 				var parentCell = $(this).parent(".cell-container");
 				// if (parentCell.hasClass("active")){
 				// 	//Go into details

 				// }

 				parentCell.toggleClass("active");
 				parentCell.toggleClass("zoom");

				e.preventDefault();
 		});



 		var lastIndexFingerTip;
		var controller = Leap.loop(function(frame){
		  if(frame.valid && frame.gestures.length > 0){
		    frame.gestures.forEach(function(gesture){
		        switch (gesture.type){
		          case "keyTap":
		              console.log("Key Tap Gesture");
		              $("#Cursor").collision(".cell").trigger('click');	
		              break;
		          case "screenTap":
		              console.log("Screen Tap Gesture");
		              $("#Cursor").collision(".cell").trigger('click');
		              break;
		        }
		    });
		  }
		  if (frame&&frame.fingers.length){
		  		var indexFingerTip = frame.fingers[1]&&frame.fingers[1].tipPosition,  // [x,y,z]
		  		 doc 	= document.documentElement, body = document.body,
		  		 deltaY = Math.round((indexFingerTip[1]-250)/5),
		  		 yThreshold = 15,
		  		 top 	= window.scrollY,
		  		 left 	= 0,
		  		 finalDeltaY = (deltaY > yThreshold || deltaY < -yThreshold)? deltaY: Math.floor(deltaY/yThreshold*2)
		  		 ;
		  		 // console.log(finalDeltaY,  top)
		  		 if ($(".cell.active").length == 0)
		  		 window.scrollTo (left, top - finalDeltaY )
		  		 lastIndexFingerTip = indexFingerTip;

		  }
		  // setCursor(frame.hands[0].screenPosition())
		  // console.log(frame.hands[1] && frame.hands[1].screenPosition)
		  frame.hands.forEach(function(hand, index) {
		    // console.log(hand.sreenPosition)
		  });

		})
		.use('screenPosition')
		.connect()


		Leap.loop(function(frame) {
		  frame.hands.forEach(function(hand, index) {
		    Cursor.setCursor(hand.screenPosition())
		  });

		}).use('screenPosition', {scale: 0.75});



		
		Cursor.create();

	});

</script>
</body>
</html>